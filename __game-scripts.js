var Controller=pc.createScript("controller");Controller.prototype.initialize=function(){},Controller.attributes.add("speed",{type:"number",default:.09}),Controller.prototype.initialize=function(){var e=this.app.root.findByName("Camera");this.cameraScript=e.script.cameraMovement},Controller.prototype.update=function(e){},Controller.worldDirection=new pc.Vec3,Controller.tempDirection=new pc.Vec3,Controller.prototype.update=function(e){var r=this.app,t=Controller.worldDirection;t.set(0,0,0);var o=Controller.tempDirection,i=this.entity.forward,a=this.entity.right,n=0,l=0;if(r.keyboard.isPressed(pc.KEY_A)&&(n-=1),r.keyboard.isPressed(pc.KEY_D)&&(n+=1),r.keyboard.isPressed(pc.KEY_W)&&(l+=1),r.keyboard.isPressed(pc.KEY_S)&&(l-=1),0!==n||0!==l){t.add(o.copy(i).mulScalar(l)),t.add(o.copy(a).mulScalar(n)),t.normalize();var c=new pc.Vec3(t.x*e,0,t.z*e);c.normalize().scale(this.speed),c.add(this.entity.getPosition());var p=this.cameraScript.eulers.x+180,s=new pc.Vec3(0,p,0);this.entity.rigidbody.teleport(c,s)}};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var e=this.app;e.mouse.on("mousemove",this.onMouseMove,this),e.mouse.on("mousedown",this.onMouseDown,this),this.rayEnd=e.root.findByName("RaycastEndPoint"),this.on("destroy",(function(){e.mouse.off("mousemove",this.onMouseMove,this),e.mouse.off("mousedown",this.onMouseDown,this)}),this)},CameraMovement.prototype.postUpdate=function(e){var t=this.entity.parent,o=this.eulers.x+180,s=this.eulers.y,i=new pc.Vec3(-s,o,0);t.setEulerAngles(i),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(t.getPosition())},CameraMovement.prototype.onMouseMove=function(e){pc.Mouse.isPointerLocked()&&(this.eulers.x-=this.mouseSpeed*e.dx/60%360,this.eulers.y+=this.mouseSpeed*e.dy/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360))},CameraMovement.prototype.onMouseDown=function(e){this.app.mouse.enablePointerLock()},CameraMovement.prototype.getWorldPoint=function(){var e=this.entity.parent.getPosition(),t=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(e,t);return o?o.point:t};var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseLookSensitivity",{type:"number",default:0,title:"Mouse Look Sensitivity"}),LookCamera.attributes.add("touchLookSensitivity",{type:"number",default:0,title:"Touch Look Sensitivity"}),LookCamera.attributes.add("snappinessFactor",{type:"number",default:.1,title:"Snappiness Factor",description:"Lower is faster"}),LookCamera.prototype.initialize=function(){this._tempQuat1=new pc.Quat,this._tempQuat2=new pc.Quat,this._tempVec3_1=new pc.Vec3;var t=this.entity.getLocalRotation();this.ey=this.getYaw(t)*pc.math.RAD_TO_DEG,this.ex=this.getPitch(t,this.ey)*pc.math.RAD_TO_DEG,this.targetEx=this.ex,this.targetEy=this.ey,this.moved=!1,this.app.mouse.disableContextMenu(),this.lastTouchPosition=new pc.Vec2,this.addEventCallbacks(),this.on("destroy",(function(){this.removeEventCallbacks()}),this)},LookCamera.prototype.addEventCallbacks=function(){this.app.mouse&&this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},LookCamera.prototype.removeEventCallbacks=function(){this.app.mouse&&this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},LookCamera.prototype.update=function(t){var o=1;this.snappinessFactor>0&&(o=t/this.snappinessFactor),this.ex=pc.math.lerp(this.ex,this.targetEx,o),this.ey=pc.math.lerp(this.ey,this.targetEy,o),this.entity.setLocalEulerAngles(this.ex,this.ey,0)},LookCamera.prototype.moveCamera=function(t,o,e){this.moved?(this.targetEx+=o*e,this.targetEx=pc.math.clamp(this.targetEx,-90,90),this.targetEy+=t*e):this.moved=!0},LookCamera.prototype.onMouseMove=function(t){this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity)},LookCamera.prototype.onTouchStart=function(t){var o=t.touches[0];this.lastTouchPosition.set(o.x,o.y)},LookCamera.prototype.onTouchMove=function(t){var o=t.touches[0];this.moveCamera(o.x-this.lastTouchPosition.x,o.y-this.lastTouchPosition.y,this.touchLookSensitivity),this.lastTouchPosition.set(o.x,o.y)},LookCamera.prototype.getYaw=function(){var t=this.entity.forward.clone();return Math.atan2(-t.x,-t.z)},LookCamera.prototype.getPitch=function(t,o){var e=this._tempQuat1,i=this._tempQuat2;i.setFromEulerAngles(0,-o,0),e.mul2(i,t);var s=this._tempVec3_1;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)};